const C = require('../../fixtures/constants');
const S = require('../../fixtures/settings');
const D = require('../../fixtures/data');
const api = require('../../api-utils/api-spec');
const ui = require('../../pages/ui-spec');
const helper = require('../../support/e2e-helper');
const E = require("../../fixtures/files/excel-data");
const {log_out} = require("../../api-utils/endpoints/auth");

const orgAdmin = S.getUserData(S.userAccounts.orgAdmin),
    powerUser = S.getUserData(S.userAccounts.powerUser),
    regularUser = S.getUserData(S.userAccounts.basicUser),
    equals = C.searchCriteria.inputFields.equals,
    equals_active_field = C.searchCriteria.multiSelectFields.equals,
    notEquals = C.searchCriteria.multiSelectFields.notEquals,
    equalsOr = C.searchCriteria.multiSelectFields.equalsOr,
    equalsAnd = C.searchCriteria.multiSelectFields.equalsAnd,
    contains = C.searchCriteria.inputFields.contains,
    textSearch = C.searchCriteria.inputFields.textSearch,
    before_ = C.searchCriteria.dates.before,
    after = C.searchCriteria.dates.after,
    between = C.searchCriteria.dates.between,
    exactly = C.searchCriteria.dates.exactly,
    newerThanX = C.searchCriteria.dates.newerThanX,
    olderThanX = C.searchCriteria.dates.olderThanX,
    betweenXandY = C.searchCriteria.dates.betweenXandY,
    currentWeek = C.searchCriteria.dates.currentWeek,
    lastWeek = C.searchCriteria.dates.lastWeek,
    monthToDate = C.searchCriteria.dates.monthToDate,
    lastMonth = C.searchCriteria.dates.lastMonth,
    yearToDate = C.searchCriteria.dates.yearToDate,
    lastYear = C.searchCriteria.dates.lastYear,
    currentMonth = helper.getCurrentMonthNumber(),
    currentYear = helper.getCurrentMonthYear();

D.case0 = {},
    D.case1 = {},
    D.case2 = {},
    D.case3 = {},
    D.case4 = S.selectedEnvironment.oldActiveCase

describe('Cases Search v2', function () {

    before(function () {
        api.auth.get_tokens(orgAdmin);
      //  api.org_settings.set_Case_Level_Permissions_on_Org_Settings(false)
        D.generateNewDataSet();

        // all imported cases will be Closed
        // D.newCase.active = false
        // D.newCase.status = 'Closed'
        // D.case1 = Object.assign({}, D.newCase)
        // D.case2 = Object.assign({}, D.newCase)
        // D.case3 = Object.assign({}, D.newCase)
        //
        // D.newCase = {
        //     caseNumber: 'searchCase1_' + S.currentDateAndTime,
        //     caseOfficerIds: [orgAdmin.id],
        //     caseOfficerGroupIds: [S.selectedEnvironment.admin_userGroup.id],
        //     offenseType: S.selectedEnvironment.offenseType2.name,
        //     offenseTypeId: S.selectedEnvironment.offenseType2.id,
        //     offenseLocation: 'New York, NY, USA',
        //     offenseDate: C.currentDate_inCurrentFormat,
        //     offenseDateIsoFormat: C.currentDate_In_ISO_Format,
        //     closedDate: C.currentDate_inCurrentFormat,
        //     closedDateIsoFormat: C.currentDate_In_ISO_Format,
        //     reviewDate: C.currentDate_inCurrentFormat,
        //     reviewDateIsoFormat: C.currentDate_In_ISO_Format,
        //     offenseDescription: 'testing search',
        //     active: false,
        //     status: 'Open',
        //     reviewDateNotes: 'generated by automated test',
        //     tagsForApi: [S.selectedEnvironment.tagA],
        //     tags: [S.selectedEnvironment.tagA.name]
        // }
        // api.org_settings.enable_all_Case_fields();
        // api.auto_disposition.edit(true);
        // ui.userAdmin.add_and_verify_new_user_and_get_tokens()
        // D.newCase.createdBy = D.newUser.firstLastName
        // api.users.update_current_user_settings('newUser')
        //
        // D.case0 = Object.assign({}, D.newCase)
        // api.cases.add_new_case(D.case0.caseNumber);
        //
        // //last week
        // D.case1.caseNumber = 'searchCase_X.X.9_' + S.currentDateAndTime
        // D.case1.createdDate = D.case1.offenseDate = D.case1.reviewDate = D.case1.closedDate
        //     = helper.getDateInPastInSpecificFormat('mm/dd/yyyy', 7)
        //
        // //last month
        // D.case2.caseNumber = 'searchCase_X.X.11_' + S.currentDateAndTime
        // D.case2.createdDate = D.case2.offenseDate = D.case2.reviewDate = D.case2.closedDate =
        //     (currentMonth > 1) ?
        //         (helper.getSpecificDateInSpecificFormat('mm/dd/yyyy', (currentMonth - 1) + '/1/' + currentYear)) :
        //         //+ ' 10 am') :
        //         (helper.getSpecificDateInSpecificFormat('mm/dd/yyyy', '12' + '/1/' + (currentYear - 1)))
        // //+ ' 10 am')
        //
        // //last year
        // D.case3.caseNumber = 'searchCase_X.X.13_' + S.currentDateAndTime
        // D.case3.createdDate = D.case3.offenseDate = D.case3.reviewDate = D.case3.closedDate
        //     = helper.getSpecificDateInSpecificFormat('mm/dd/yyyy', '1/1/' + (currentYear - 1))
        // //+ ' 10 am'
        //
        // E.generateDataFor_CASES_Importer([D.case1, D.case2, D.case3]);
        // cy.generate_excel_file('Cases_forTestingSearchParameters', E.caseImportDataWithAllFields);
        // ui.menu.click_Tools__Data_Import();
        // ui.importer.upload_then_Map_and_Submit_file_for_importing('Cases_forTestingSearchParameters', C.importTypes.cases)
        //     .verify_toast_message([
        //         C.toastMsgs.importComplete,
        //         3 + C.toastMsgs.recordsImported])
        // ui.menu.click_Log_Out()
    });
    context('1 Org Admin', function () {


        context('1.1 Created By + Created Date', function () {

            it('1.1.1 Created By equals {email of the user (current user) who created a case} AND Created Date exactly today', function () {
                api.auth.get_tokens(orgAdmin);
                D.generateNewDataSet();
                api.cases.add_new_case(D.newCase.caseNumber)
                ui.menu.click_Search__Case()
                .turn_ON_search_v2_toggle()
                ui.searchCase.select_field_on_search_v2(C.searchCriteria.fields.createdBy)
                     .enter_Created_By(equals, S.userAccounts.orgAdmin.email)
ui.menu.click_add_search_criteria_on_v2()
                ui.searchCase.select_field_on_search_v2(C.searchCriteria.fields.createdDate, 1)
                    .enter_Created_Date(exactly, S.currentDate)

                //     .click_Search()
                //     .verify_data_on_the_grid(D.case0);
                // ui.menu.click_Log_Out()
            });
        });
    });
});
